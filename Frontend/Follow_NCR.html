<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!----======== CSS ======== -->
    <link rel="stylesheet" href="IOR.css">
    <!----===== Iconscout CSS ===== -->
    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.0/css/line.css">
    <title>NON-CONFORMANCE REPORT (NCR)</title>
</head>

<style>
    /* Add styles for button spacing and appearance */
    .container header button {
        margin-right: 10px;
        /* Adjust the margin as needed */
        background-color: #ffffff;
        /* Blue background color */
        color: #000000;
        border-color: #265df2;
        /* White text color */
        font-weight: normal;
        /* Bold text */
        padding: 5px 10px;
        /* Adjust padding as needed */
        /* Remove button border */
        border-radius: 5px;
        /* Add border-radius for rounded corners */
        cursor: pointer;
    }

    .container header button:hover {
        background-color: #265df2;
        /* Darker blue on hover */
    }
</style>

<body>
    <div class="container" id="app">
        <header>
            NON-CONFORMANCE REPORT (NCR)
            <header>
                <!-- Replace the title with buttons -->
                <button @click="redirectToFollowOccur('NCR')">NCR</button>
                <button @click="redirectToFollowOccur('FollowOn')">Follow On</button>
            </header><br>
            <span>Follow On</span>
        </header>
        <form @submit.prevent="FollowNCR" action="#">
            <div class="form first">
                <div class="details personal">
                    <div class="fields">
                        <div class="input-field" v-for="(value, key) in FollowNCR_data" :key="key">
                            <label>{{ key.replace(/_/g, ' ') }}</label>

                            <input v-if="key === 'proposed_close_date' || key === 'close_approveddate' || key === 'verif_date'" type="date"
                                v-model="FollowNCR_data[key]" required>

                            <select v-else-if="key === 'is_close'" v-model="FollowNCR_data[key]">
                                <option value="true">Close</option>
                                <option value="false">Open</option>
                            </select>

                            <select v-else-if="key === 'effective'" v-model="FollowNCR_data[key]">
                                <option value="Effective">Effective</option>
                                <option value="Not Effective">Not Effective</option>
                            </select>

                            <input v-else type="text" placeholder="Enter your data" v-model="FollowNCR_data[key]" required>
                        </div>
                    </div>
                </div>
                <button class="nextBtn" type="submit">
                    <span class="btnText">Submit</span>
                    <i class="uil uil-navigator"></i>
                </button>
            </div>
        </form>
        <p>{{ loginMessage }}</p>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.5/axios.min.js"
        integrity="sha512-TjBzDQIDnc6pWyeM1bhMnDxtWH0QpOXMcVooglXrali/Tj7W569/wd4E8EDjk1CwOAOPSJon1VfcEt1BI4xIrA=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script type="module">

        import { createApp, ref } from 'https://unpkg.com/vue@3/dist/vue.esm-browser.js';

        createApp({
            data() {
                return {
                    title: "FollowUp NCR",
                    FollowNCR_data: {
                        accountid: '',
                        ncr_init_id: '',
                        close_corrective: '',
                        proposed_close_audit: '',
                        proposed_close_date: '',
                        is_close: '',
                        effective: '',
                        refer_verif: '',
                        sheet_no: '',
                        new_ncr_issue_no: '',
                        close_approvedby: '',
                        close_approveddate: '',
                        verif_chied: '',
                        verif_date: '',
                        temporarylink: ''
                    },
                    loginMessage: ''
                };
            },
            methods: {
                async FollowNCR() {
                    console.log("Sending data:", this.FollowNCR_data);
                    try {
                        const response = await axios.post("http://localhost:3000/addNCRFollowResult", this.FollowNCR_data);

                        if (response.data.status === 200 && response.data.message === 'NRC Follow Result Created') {
                            this.loginMessage = 'Follow Occurrence added successfully';
                        } else {
                            this.loginMessage = 'Failed to add occurrence';
                        }
                    } catch (error) {
                        console.error("Error during login:", error);
                        this.loginMessage = 'Failed to add occurrence' + error;
                    }
                },

                redirectToFollowOccur(buttonType) {
                    if (buttonType === 'NCR') {
                        // Redirect to the Occurence page
                        window.location.href = 'NCR_Form.html';
                    } else if (buttonType === 'FollowOn') {
                        // Redirect to the Follow_Occur page
                    }
                }

            }
        }).mount('#app');
    </script>
</body>

</html>

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!----======== CSS ======== -->
    <link rel="stylesheet" href="IOR.css">
    <!----===== Iconscout CSS ===== -->
    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.0/css/line.css">
    <title>NON-CONFORMANCE REPORT (NCR)</title>
</head>
<body>
    <div class="container" id="app">
        <header>
            NON-CONFORMANCE REPORT (NCR)
        </header>
        <form @submit.prevent="IOR" action="#">
            <!-- Use @submit.prevent to prevent the default form submission behavior -->
            <div class="form first">
                <div class="details personal">
                    <div class="fields">
                        <div class="input-field" v-for="(value, key) in NCR_data" :key="key">
                            <label>{{ key.replace(/_/g, ' ') }}</label>

                            <input v-if="key === 'issued_date' ||key === 'answer_duedate'||key === 'audit_date'||key === 'acknowledge_date'" type="date" v-model="NCR_data[key]" required> 

                            <select v-else-if="key === 'problem_analis'" v-model="NCR_data[key]">
                                <option value="Required">Required</option>
                                <option value="Not Required">Not Required</option>
                            </select>

                            <select v-else-if="key === 'regulationbased'" v-model="NCR_data[key]">
                                <option value="DGCA">DGCA</option>
                                <option value="EASA">EASA</option>
                            </select>

                            <select v-else-if="key === 'audit_type'" v-model="NCR_data[key]">
                                <option value="Procedure">Procedure</option>
                                <option value="Product">Product</option>
                                <option value="Surveillance">Surveillance</option>
                            </select>

                            <select v-else-if="key === 'audit_scope'" v-model="NCR_data[key]">
                                <option value="Authority">Authority</option>
                                <option value="Internal">Internal</option>
                                <option value="External">External</option>
                                <option value="Subcontractor">Subcontractor</option>
                            </select>

                            <select v-else-if="key === 'to_uic'" v-model="NCR_data[key]">
                                <option value="Chief Design Office">Chief Design Office</option>
                                <option value="Chief Airworthiness Office">Chief Airworthiness Office</option>
                                <option value="Chief Independent Monitoring">Chief Independent Monitoring</option>
                                <option value="Head of DOA">Head of DOA</option>
                            </select>

                            <select v-else-if="key === 'level_finding'" v-model="NCR_data[key]">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                            </select>

                            <select v-else-if="key === 'problem_analis'" v-model="NCR_data[key]">
                                <option value="Required">Required</option>
                                <option value="Not required">Not required</option>
                            </select>

                            <select v-else-if="key === 'issue_ian'" v-model="NCR_data[key]">
                                <option value="true">Yes</option>
                                <option value="false">No</option>
                            </select>

                            <select v-else-if="key === 'status'" v-model="NCR_data[key]">
                                <option value="Open">Open</option>
                                <option value="Closed">Closed</option>
                                <option value="Monitor">Monitor</option>
                            </select>
                            
                            <select v-else-if="key === 'responsible_office'" v-model="NCR_data[key]">
                                <option value="AO: Airworthiness Office">AO: Airworthiness Office</option>
                                <option value="DO: Design Office">DO: Design Office</option>
                                <option value="IM: Independent Monitoring">IM: Independent Monitoring</option>
                                <option value="PR: Partner">PR: Partner</option>
                                <option value="SC: Subcontractor">SC: Subcontractor</option>
                                <option value="BR: BRIN">BR: BRIN</option>
                                <option value="GF: GMF AeroAsia">GF: GMF AeroAsia</option>
                                <option value="BA: BIFA Flying School">BA: BIFA Flying School</option>
                                <option value="EL: Elang Lintas Indonesia">EL: Elang Lintas Indonesia</option>
                            </select>

                            <textarea v-else-if="key === 'subject'" rows="2" v-model="NCR_data[key]" placeholder=" Enter your data" required></textarea>

                            <input v-else type="text" placeholder="Enter your data" v-model="NCR_data[key]" required>
                        </div>
                    </div>
                </div>
                <button class="nextBtn" type="submit">
                    <span class="btnText">Submit</span>
                    <i class="uil uil-navigator"></i>
                </button>
            </div>
        </form>
        <p>{{ loginMessage }}</p>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.5/axios.min.js"
        integrity="sha512-TjBzDQIDnc6pWyeM1bhMnDxtWH0QpOXMcVooglXrali/Tj7W569/wd4E8EDjk1CwOAOPSJon1VfcEt1BI4xIrA=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script type="module">
        
        import { createApp, ref } from 'https://unpkg.com/vue@3/dist/vue.esm-browser.js';

        createApp({
            data() {
                return {
                    title: "IOR",
                    NCR_data: {
                        accountid: '',
                        regulationbased: '',
                        subject: '',
                        audit_no: '',
                        ncr_no: '',
                        issued_date: '',
                        responsible_office: '',
                        audit_type: '',
                        audit_scope: '',
                        to_uic: '',
                        attention: '',
                        require_condition: '',
                        level_finding: '',
                        problem_analis: '',
                        answer_duedate: '',
                        issue_ian: '',
                        ian_no: '',
                        encounter_condition:'',
                        audit_by: '',
                        audit_date: '',
                        acknowledge_by: '',
                        acknowledge_date: '',
                        status: '',
                        temporarylink: ''
                    },
                    loginMessage: ''
                };
            },
            methods: {
                async IOR() {
                    console.log("Sending data:", this.NCR_data);
                    try {
                        const response = await axios.post("http://localhost:3000/addNCRInit", this.NCR_data);

                        if (response.data.status === 200) {
                            this.loginMessage = 'NCR added successfully';
                        } else {
                            this.loginMessage = 'Failed to add NCR';
                        }
                    } catch (error) {
                        this.loginMessage = 'Failed to add NCR' + error;
                    }
                },

                redirectToFollowOccur(buttonType) {
                    if (buttonType === 'Occurrence') {
                        // Redirect to the Occurrence page
                        window.location.href = 'Satu.html';
                    } else if (buttonType === 'FollowOn') {
                        // Stay on the Follow_On page
                        // You can add additional logic if needed
                    }
                }
            }
        }).mount('#app');
    </script>
</body>

</html>

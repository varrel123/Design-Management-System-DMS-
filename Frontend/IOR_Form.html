<!DOCTYPE html>
<!-- Coding By CodingNepal - codingnepalweb.com -->
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!----======== CSS ======== -->
    <link rel="stylesheet" href="IOR.css">
    <!----===== Iconscout CSS ===== -->
    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.0/css/line.css">
    <title>INTERNAL OCCURRENCE REPORT (IOR)</title>
</head>

<body>
    
    <ul class="nav-links">
        <img src="image/gmf9.png" alt="Login Image" style="width: 95%; max-width: 300px; margin-bottom: 0px; margin-left: 0px;">
        <li><a href="main_menu.html">Main Menu</a></li>
        <li class="center"><a href="Account.html">Account</a></li>
        <li><a href="NCR_Form.html">Audit</a></li>
        <li class="upward"><a href="IOR_Form.html">Occurrence</a></li>
        <li class="forward"><a href="#">Personnel</a></li>
        <li class="forward"><a href="#">Project</a></li>
        <li class="forward"><a href="#">Link</a></li>
        <li class="forward"><a href="index.html">Exit</a></li>
      </ul>

    <div class="container" id="app">
        <header>
            <div class="ncr-title">INTERNAL OCCURRENCE REPORT</div>
            <header>
                <ul class="nav-links2">
                    <li><a href="IOR_Form.html">IOR</a></li>
                    <li class="center"><a href="Follow_Occur.html">Follow On</a></li>
                  </ul>
            </header>
        </header>
        <form @submit.prevent="IOR" action="#">
            <!-- Use @submit.prevent to prevent the default form submission behavior -->
            <div class="form first">
                <div class="details personal">
                    <div class="fields">
                        <div class="input-field" v-for="(value, key) in IOR_data" :key="key">
                            <label>{{ key.replace(/_/g, ' ') }}</label>
                            <input v-if="key === 'occur_date'||key === 'report_date'" type="date"
                                v-model="IOR_data[key]" required>
                            <input v-else-if="key === 'occur_nbr'" type="text" placeholder="YYYY-MM-SSS"
                                pattern="\d{4}-\d{2}-\d{3}" v-model="IOR_data[key]" required>
                            <select v-else-if="key === 'level_type'" v-model="IOR_data[key]">
                                <option value="Aircraft" selected>Aircraft</option>
                                <option value="Engine">Engine</option>
                                <option value="APU">APU</option>
                                <option value="Others">Others</option>
                            </select>
                            <input v-else-if="key === 'data_reference'" type="checkbox" v-model="IOR_data[key]">
                            <select v-else-if="key === 'reporter_identity'" v-model="IOR_data[key]">
                                <option value="Shown" selected>Shown</option>
                                <option value="Hidden ">Hidden </option>
                            </select>
                            <select v-else-if="key === 'hirac_process'" v-model="IOR_data[key]"> class="input-field
                                full-width"
                                <option value="Yes" selected>Yes</option>
                                <option value="No">No </option>
                            </select>
                            <textarea v-else-if="key === 'detail_occurance'" placeholder=" Enter your data" rows="2"
                                v-model="IOR_data[key]" required></textarea>
                            <input v-else type="text" placeholder="Enter your data" v-model="IOR_data[key]" required>
                        </div>
                    </div>
                </div>


                <button class="nextBtn" type="submit">
                    <!-- Change the button to submit -->
                    <span class="btnText">Submit</span>
                    <i class="uil uil-navigator"></i>
                </button>
            </div>
        </form>
        <p>{{ loginMessage }}</p>
    </div>
    <script src="https://unpkg.com/vue@3/dist/vue.esm-browser.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.5/axios.min.js"
        integrity="sha512-TjBzDQIDnc6pWyeM1bhMnDxtWH0QpOXMcVooglXrali/Tj7W569/wd4E8EDjk1CwOAOPSJon1VfcEt1BI4xIrA=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script type="module">
        import { createApp, ref } from 'https://unpkg.com/vue@3/dist/vue.esm-browser.js';

        createApp({
            data() {
                return {
                    title: "IOR",
                    IOR_data: {
                        subject_ior: '',
                        occur_nbr: '',
                        occur_date: '',
                        reference_ior: '',
                        to_uic: '',
                        cc_uic: '',
                        category_occur: '',
                        type_or_pnbr: '',
                        level_type: '',
                        detail_occurance: '',
                        ReportedBy: '',
                        reporter_uic: '',
                        report_date: '',
                        reporter_identity: '',
                        Data_reference: '',
                        hirac_process: '',
                        initial_probability: '',
                        initial_severity: '',
                        initial_riskindex: ''
                    },
                    loginMessage: ''
                };
            },
            methods: {
                redirectToMainMenu() {
                    window.location.href = 'main_menu.html';
                },
                async IOR() {
                    console.log("Sending data:", this.IOR_data);
                    try {
                        const response = await axios.post("http://localhost:3000/addOccurrence", this.IOR_data);
                        console.log(this.IOR_data);

                        if (response.data.status === 200 && response.data.message === 'Occurrence Created') {
                            this.loginMessage = 'Occurrence added successfully';
                        } else {
                            this.loginMessage = 'Failed to add occurrence';
                        }
                    } catch (error) {
                        console.error("Error during login:", error);
                        this.loginMessage = 'Failed to add occurrence' + error;
                    }
                },

                redirectToFollowOccur(buttonType) {
                    if (buttonType === 'Occurence') {
                        // Redirect to the Occurence page
                        window.location.href = 'index.html';
                    } else if (buttonType === 'FollowOn') {
                        // Redirect to the Follow_Occur page
                        window.location.href = 'Follow_Occur.html';
                    }
                }
            }
        }).mount('#app');
    </script>
</body>

</html>
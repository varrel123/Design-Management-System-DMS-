<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NCR Searching</title>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.6/css/jquery.dataTables.min.css">
</head>

<body>
    <div id="app">
        <h2>{{ title }}</h2>

        <div class="show-table" style="margin-top: 134px;" >
            <div class="table-responsive"  style="overflow: auto;">
                <table class="table" id="data-table" style="background-color: white; overflow-y:scroll;">
                    <thead style="background-color: #CCE6F4;">
                        <tr>
                            <th>NCR Init ID</th>
                            <th>Regulation Based</th>
                            <th>Subject</th>
                            <th>Audit Plan No</th>
                            <th>NCR No</th>
                            <th>Issued Date</th>
                            <th>Responsibility Office</th>
                            <th>Audit Type</th>
                            <th>To UIC</th>
                            <th>Require Condition Reference</th>
                            <th>Level Finding</th>
                            <th>Problem Analis</th>
                            <th>Answer Due Date</th>
                            <th>Issued IAN</th>
                            <th>IAN No</th>
                            <th>Encountered Condition</th>
                            <th>Audit By</th>
                            <th>Audit Date</th>
                            <th>Acknowledge By</th>
                            <th>Acknowledge Date</th>
                            <th>Status</th>
                            <th>Temporary Link</th>
                        </tr>
                    </thead>
                    <tbody>

                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@3"></script>
    <script type="module">
        import { createApp, ref } from 'https://unpkg.com/vue@3/dist/vue.esm-browser.js';

        document.addEventListener("DOMContentLoaded", async () => {
            createApp({
                data() {
                    return {
                        title: "Searching NCR",
                        itemList: [],
                        loginMessage: ''
                    };
                },
                methods: {
                    async fetchDataFromServer() {
                        try {
                            const response = await axios.get("http://localhost:3000/showNCRInit");
                            console.log('Response Data:', response.data);

                            if (response.data.status === 200) {
                                const items = response.data.showProduct;
                                console.log('Data:', response.data.showProduct);
                                const tableBody = $('#data-table tbody');
                                tableBody.empty();
                                items.forEach(function (item) {
                                    const row = document.createElement("tr");
                                    row.innerHTML = `
                                    <td>${item.ncr_init_id}</td>
                                    <td>${item.regulationbased}</td>
                                    <td>${item.subject}</td>
                                    <td>${item.audit_plan_no}</td>
                                    <td>${item.ncr_no}</td>
                                    <td>${item.issued_date}</td>
                                    <td>${item.responsibility_office}</td>
                                    <td>${item.audit_type}</td>
                                    <td>${item.to_uic}</td>
                                    <td>${item.require_condition_reference}</td>
                                    <td>${item.level_finding}</td>
                                    <td>${item.problem_analysis}</td>
                                    <td>${item.answer_due_date}</td>
                                    <td>${item.issue_ian}</td>
                                    <td>${item.ian_no}</td>
                                    <td>${item.encountered_condition}</td>
                                    <td>${item.audit_by}</td>
                                    <td>${item.audit_date}</td>
                                    <td>${item.acknowledge_by}</td>
                                    <td>${item.acknowledge_date}</td>
                                    <td>${item.status}</td>
                                    <td>${item.temporarylink}</td>
                                    <td>
                                        <button @click="() => previewAction(item.ncr_no)">Preview</button>
                                        <button @click="() => editAction(item.ncr_no)">Edit</button>
                                    </td>
                                    `;
                                    tableBody.append(row);
                                });

                                
                            } else {
                                console.error('Error Message:', response.data.message);
                            }
                        } catch (error) {
                            console.error('Error:', error);
                        }
                    }
                },
                mounted() {
                    this.fetchDataFromServer();
                    setInterval(() => {
                        this.fetchDataFromServer();
                    }, 5000);
                }
            }).mount('#app');
        });
    </script>
</body>

</html>